<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>text</title>
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport"/>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="css/comm.css?t=1" rel="stylesheet">
     <link rel="stylesheet" href="css/ui-box.css">
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/ui-input.css">
    <link rel="stylesheet" href="css/project/style.css">
    <link rel="stylesheet" href="indexCon_0/css/main.css">
     <script src="js/zy_control.js"></script>
    <script src="js/zy_tmpl.js"></script>
    <script src='js/zy_slide.js'></script>
        <script src="js/jquery.min.js"></script>
          <script src="js/appcan.js"></script>
    <script src="js/appcan.control.js"></script>
    <script src="js/appcan.tab.js"></script>
       <script type="text/javascript">
                var cText = 0;
                var cJson = 1;
                var cInt = 2;
                //启动定位功能，返回的通知函数 的回调函数
                function locationCallback(lat, log){
                    document.getElementById('longitude').value = log;
                    document.getElementById('latitude').value = lat;
                    document.getElementById('location').innerHTML = "经度:" + log + " ,纬度:" + lat;
                   
                }
            //根据经纬度获取具体地址
            function LocationSuccess(opCode, dataType, data){
                document.getElementById('adre').innerHTML = data;
                var adress=data.substring(data.indexOf(":")+2, data.indexOf(",")-1);
                  document.getElementById('adress').innerHTML =adress;
            }
             
            //获取当前经纬度
            function locationFun(){
                //0最准确，1十米以内 ，2百米以内，3千米内，4三千米以内
                var locLevel = 0;
                //distanceFilter 更新距离，如果设置为 100m,则100m以内不回调定位
                var distanceFilter = 10;
                //以上两参数仅ios支持
                uexLocation.openLocation(locLevel, distanceFilter);
               
            }
            </script>
</head>
<style>
 
</style>
<body class="">
<div class="wrap dabg">
   
     <section id="sec1" class="main main2 dabg">
        <div class="top-menu">
            <div class="left openMenu" onclick="$('body').toggleClass('actives')"><img src="images/icon/menu.png" alt=""></div>
            <span class="right" onclick="appcan.openWinWithUrl('评论','surch.html');"><img src="images/icon/menu2.png" alt=""></span>
             <span class="right ser" onclick="uexLocation.getAddress(document.getElementById('latitude').value,document.getElementById('longitude').value,1);"><img src="images/icon/menu1.png" alt=""></span>
            <div class="sort">
<ul>
    <li class="checked" id="qbsj">全部商家</li>
     <li id="huodsj">活动商家</li>
</ul>
</div>
            
        </div>
        
        <div class="other-pru dabg" id="heighnei">
            <!--内嵌的网页形式页面-->
            
            
            <div class="newtx" >
                <div class="leftfl"> 分类 <div id="classle" class="xibux"> </div></div>
               <span id="adress">重庆市</span>
                <div class="regtfl" onclick="uexLocation.getAddress(document.getElementById('latitude').value,document.getElementById('longitude').value,1);"><img src="images/B2oy_03.png" /> </div>
                
                
                <!--隐藏的分类列表--->
                <div class="inste">
                    <div class="feileiz">
                        <div class="claszbian">
                            <ul id="hyfl">
                                <li class="bgcc">全部分类</li>
                                
                            </ul> 
                             </div>
                            <div class="classyou">
                                 <ul id="dpfl">
                                    <li>全部分类 <span>22222</span></li>
                                 </ul> 
                                 </div>
                    </div> 
                     <div id="xiabuf" class="xiabuf"></div>
               </div>
                
               </div>
                     <div class="conbor dabg">
            <div class="colorcccc" style="background-color: #FFFFFF;display: none;" >
                <span>1.获取当前经纬度：</span>
                <input class="btn" type="button" value="获取当前经纬度" onclick="locationFun();">
                    <span>当前的经纬度值为：</span>
                    <div class="tcxx" id="location">
                    </div>
                    <input type="hidden" id="longitude"><input type="hidden" id="latitude">
                        <span>2.获取当前地址</span>
                        <input class="btn" type="button" value="获取当前地址值" onclick="uexLocation.getAddress(document.getElementById('latitude').value,document.getElementById('longitude').value,1);">
                            <span>获取当前地址值为：</span>
                            <div class="tcxx" id="adre"></div>
                             </div>
        </div>
      
            
            <!---真真假假已看透图片轮播-->
            
        <div id='' class='myh ub-fh t-bla uof'>
            <div id='slider' class='ub-con ub ub-fh'>
            </div>
            <div class="ub ub-ac ub-pc ub-fh" style="position:absolute; left:0;bottom:0;">
                <div class="ub uinn-a1" id="proint">
                    <div class="uc-a-for1 uwh-for1 c-wh umar-r-for"></div>
                    <div class="uc-a-for1 uwh-for1 c-gra-for2 umar-r-for"></div>
                    <div class="uc-a-for1 uwh-for1 c-gra-for2 umar-r-for"></div>
                </div>
            </div>
        </div>
  
        <div id="divSJ" >
        <!--下面的商家列表
            <div class="ub">
        <div class="tjshangj borbom">
             <div class="huoguo">
                 <img src="css/project/images/huoguo.png" />
              
             </div>
             <div class="conwai">
                 <div class="yousf">115人消费</div>
                 <div class="titlls">小天鹅火锅（沙坪坝凯德店）小天鹅火锅（沙坪坝凯德店） </div>
                  <div class="titlls2">【沙坪坝区】吃货推介 </div>
                  <div class="jindou"><img src="images/B2y1.png" />百吃百送；<img src="images/B2con.png" />金豆消费</div>
                 <div class="mishuxia">561米</div>
                 </div>
           </div>
           
        </div>
        --->
        </div>
        <div id="hdsj" style="display: none;"><span class="colcc">我是活动商家</span></div> 
        
        
        <div id="container"></div>
     
     
</div>
</div> 

        </div>

    <section class="scrollnone">
        <section class="menuMore">
            <div id="grzl"></div>
            <!--
            <div class="touxiang" id="nameImage"></div>
           <div class="jinbi ">金币<p>0</p></div>
           <div class="jinbi2">积分 <p>0</p> </div>
           -->
           <div class="clear" style="height: 1.2em;"></div>
            
           <div class="grzxli" onclick="shouye();"><img src="images/icon/cy-lph.png"/>乐品汇</div>
            <div class="grzxli" onclick="jfsc();"><img src="images/icon/cy-jfsc.png"/>积分商城</div>
            <div class="grzxli" onclick="grzx();"><img src="images/icon/cy-grzx.png"/>个人中心</div>
             <div class="grzxli" onclick="lljl();"><img src="images/icon/cy-zj.png"/>足迹</div>
              <div class="grzxli" onclick="grsz();"><img src="images/icon/cy-sz.png"/>个人资料设置</div>
               <div class="grzxli" onclick="$('body').toggleClass('actives')"><img src="images/icon/cy-tc.png" />退出</div>
            
           <div class="aboutlph">关于</div>
        </section>
    </section>
</div>
<div style="display: none;" id="yc1"></div>
<div style="display: none;" id="yc2"></div>
<div style="display: none;" id="yc3"></div>
<div style="display: none;" id="yc4"></div>
<div data-role="footer"></div>
</body>
<script src="js/comm.js"></script>
 <script>
function hdsj(){
    
}

//首页
function shouye(){
    appcan.openWinWithUrl('index'+Math.random(),'index.html');
}

//积分商城
function jfsc(){
    appcan.openWinWithUrl('gfsc'+Math.random(),'gfsc.html');
}

//个人中心
function grzx(){
    appcan.openWinWithUrl('grzx'+Math.random(),'grzx.html');
}

//足迹
function lljl(){
    appcan.openWinWithUrl('lljl'+Math.random(),'lljl.html');
}

//个人资料设置
function grsz(){
    appcan.openWinWithUrl('szxb'+Math.random(),'szxb.html');
}




window.onload = function(){
    var openMenu = document.querySelector('.main2 .openMenu');
    var main2 = document.querySelector('.main2');
   //openMenu.onclick = function(){
       // document.body.classList.add('actives');
    //};
    main2.addEventListener('touchstart',function(){
       document.body.classList.remove('actives');
    });
}
//改
zy_init();
window.uexOnload=function(type){
    appcan.window.openToast({
                msg : '正在获取数据...',
                duration : 2000,
                position : 5,
                type : 0
            });
    
  adImg();
  
   locationFun();
     uexLocation.onChange = locationCallback;
                uexLocation.cbGetAddress = LocationSuccess;
                uexWidgetOne.cbError = function(opCode, errorCode, errorInfo){
                    alert("errorCode:" + errorCode + "\nerrorInfo:" + errorInfo);
                }
                
                
  var _name=window.localStorage["mobile"];
  //数据绑定会员头像，名称，金币，积分
  $.getJSON("http://211.149.186.252:1690/aos/memberUser/listDataBinding.do?start=0&&limit=10&&name="+_name,function(data){
        var objs = eval(eval(data));
        for(var i=0;i<data._rows.length;i++){
            $("#grzl").append("<div class=\"touxiang\"><img src=\""+data._rows[i].user_photo+"\" />"+data._rows[i].mobile+"</div><div class=\"jinbi \">金币<p>"+data._rows[i].gold+"</p></div><div class=\"jinbi2\">积分 <p>"+data._rows[i].silver_coin+"</p> </div>");
            window.localStorage["silver_coin"]=data._rows[i].silver_coin;
            window.localStorage["mobile"]=data._rows[i].mobile;
            window.localStorage["touxiang"]=data._rows[i].silver_coin;
            window.localStorage["user_name"]=data._rows[i].user_name;
            window.localStorage["sex"]=data._rows[i].sex;
            window.localStorage["zhifupass"]=data._rows[i].silver_coin;
            window.localStorage["userID"]=data._rows[i].id;
        }
  });

    var _start=0;
    var _limit=10;
    window.localStorage["start"]=_start; 
    window.localStorage["limit"]=_limit;

 $.getJSON("http://211.149.186.252:1690/aos/supplierLocation/dataBinding.do?start="+_start+"&&limit="+_limit+"&&is_close=0",function(data){

        var objs = eval(eval(data));
        for(var i=0;i<data._rows.length;i++){
             var result_money = parseInt(data._rows[i].result_money);
             if(result_money >= 1){
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
                 $("#hdsj").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }else{
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\">"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }
        }
    });
    
  //加载分类菜单
    $.getJSON("http://211.149.186.252:1690/aos/aos/storesupplier/getParentLocationPro.do?start=0&&limit=10",function(data){
        var objs = eval(eval(data));
        for(var i=0;i<data._rows.length;i++){
            $("#hyfl").append("<li class=\"dianji"+data._rows[i].deal_cate_id+"\" onclick=\"dianji1("+data._rows[i].deal_cate_id+");\">"+data._rows[i].deal_cate_name+"</li>");
        }
    });
}

//加载更多
function jzgd(){
    var _start=parseInt(window.localStorage["start"]) + 10;
    var _limit=parseInt(window.localStorage["limit"]);
    window.localStorage["start"]=_start; 
    window.localStorage["limit"]=_limit;
     $.getJSON("http://211.149.186.252:1690/aos/supplierLocation/dataBinding.do?start="+_start+"&&limit="+_limit+"&&is_close=0",function(data){
        var objs = eval(eval(data));
        for(var i=0;i<data._rows.length;i++){
             var result_money = parseInt(data._rows[i].result_money);
             if(result_money >= 1){
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
                 $("#hdsj").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }else{
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" style=\"width:100%; height:100%\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\">"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }
        }
    });
}


//分类搜索点击事件
function dianji1(deal_cate_id){ 
    $("#dpfl").empty();
    
      $(".claszbian li").removeClass("bgcc");
       $(".dianji"+deal_cate_id).toggleClass("bgcc");
    
    $.getJSON("http://211.149.186.252:1690/aos/aos/storesupplier/getLocationPro.do?start=0&&limit=10&&parent_id="+deal_cate_id,function(data){
        var objs = eval(eval(data));
        for(var i=0;i<data._rows.length;i++){
            $("#dpfl").append("<li  onclick=\"dianji2('"+data._rows[i].deal_cate_name+"');\">"+data._rows[i].deal_cate_name+"</li>");
        }
       
    });
     
}


function dianji2(deal_cate_name){
    $("#divSJ").empty();
    $.getJSON("http://211.149.186.252:1690/aos/aos/storesupplier/getLocation.do?start=0&&limit=10&&deal_cate_match_row="+deal_cate_name,function(data){
        var objs = eval(eval(data));
          $("#classle").removeClass("xibux");
          $("#classle").removeClass("shangbux");
          $(".tjshangj").removeClass("zentimohu");
          $(".inste").fadeOut();
        for(var i=0;i<data._rows.length;i++){
            var result_money = parseInt(data._rows[i].result_money);
             if(result_money >= 1){
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
                 $("#hdsj").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\"><img src=\"images/B2y1.png\" />满100送"+data._rows[i].result_money+"；"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }else{
                 $("#divSJ").append("<div class=\"ub\" onclick=\"sjxq("+data._rows[i].id+");\"><div class=\"tjshangj borbom \">     <div class=\"huoguo\">         <img src=\""+data._rows[i].index_img+"\" />            </div>     <div class=\"conwai\">         <div class=\"yousf\">"+data._rows[i].consumption_count+"人消费</div>         <div class=\"titlls\">"+data._rows[i].name+"</div>          <div class=\"titlls2\">【"+data._rows[i].address+"】"+data._rows[i].is_recommend+" </div>          <div class=\"jindou\">"+data._rows[i].is_gold_consumption+"</div>         <div class=\"mishuxia\">"+data._rows[i].distance+"米</div>         </div>   </div></div>");
             }
        }
    });
}

function sjxq(locationId){
    window.localStorage["locationId"]=locationId;
   appcan.openWinWithUrl('all_shxq'+Math.random(),'all_shxq.html');
  /*    $(this).swipe({
 //   appcan.openWinWithUrl('all_shxq'+locationId,'all_shxq.html');
      $("#divSJ").swipe({
                    swipeRight:function(event, direction, distance, duration, fingerCount) {
                    $('body').toggleClass('actives');
                     },
                     click:function(event, direction, distance, duration, fingerCount) {
                     appcan.openWinWithUrl('all_shxq12121'+locationId,'all_shxq.html');
                 }
                   });*/
}

function adImg(){
   //加载广告图
   var photo0,photo1,photo2,photo3;
    $.getJSON("http://211.149.186.252:1690/aos/integralAD/getIntegralPhoto.do?start=0&&limit=10",function(data){
        var objs = eval(eval(data));
        var arrAd= [{
            "adImg": data._rows[0].photo,
        }, {
            "adImg": data._rows[1].photo,
        },{
            "adImg":data._rows[2].photo,
        }];
    var tmpl = '<div class="ub-fh">' 
                +'  <div class="ub ub-ver ub-img1 myh ub-fh" style="background-image:url(${adImg});"></div>'
                +'</div>'
    var s = zy_tmpl(tmpl, arrAd, zy_tmpl_count(arrAd));
    $$('slider').innerHTML = s;
    
    //显示小点
    var str = '';
    for(var i=0;i<arrAd.length;i++){
        if(i == 0){
            str += '<div id="num'+i+'" class="uc-a-for1 uwh-for1 c-wh umar-r-for"></div>';
        }else{
            str += '<div id="num'+i+'" class="uc-a-for1 uwh-for1 c-gra-for2 umar-r-for"></div>';
        }
    }
    $$('proint').innerHTML=str;
    
    //滑动时当前图片的小点颜色为白色
    var slider = new zySlide("slider", "H", function(){
            var cur = slider.currentPoint;
            var length = slider.maxPoint;
            for(var n=0;n<=length;n++){
            if (n == cur) {
                $$("num" + n).className = 'uc-a-for1 uwh-for1 c-wh umar-r-for';
            }else {
                $$("num" + n).className = 'uc-a-for1 uwh-for1 c-gra-for2 umar-r-for';
            }
        }
        },false,function(e){
        }); 
    });
}   


</script>
 <script type="text/javascript">
          $(function(){
               $("#huodsj").click(function() {
                   $(".sort li").removeClass("checked");
                     $(this).toggleClass("checked");
                     $("#hdsj").show();
                       $("#divSJ").hide();
                  });
                  $("#qbsj").click(function() {
                   $(".sort li").removeClass("checked");
                     $(this).toggleClass("checked");
                     $("#hdsj").hide();
                       $("#divSJ").show();
                  });
                  
                  $(".leftfl").click(function() {
                      $("#classle").toggleClass("xibux");
                      $("#classle").toggleClass("shangbux");
                       $(".tjshangj").toggleClass("zentimohu");
                       $(".inste").fadeToggle(100);
                  });
                   

        var nScrollHight = 0; //滚动距离总长(注意不是滚动条的长度)
        var nScrollTop = 0;   //滚动到的当前位置
        
        
        $("#heighnei").scroll( function() {
        var nDivHight = $("#heighnei").height();
        nScrollHight = $(this)[0].scrollHeight;
          nScrollTop = $(this)[0].scrollTop;
         var futop=nScrollTop + nDivHight+20;
        
         // console.log(nDivHight+","+nScrollTop+","+futop+","+nScrollHight);
          if(futop >= nScrollHight){  
              jzgd();
                appcan.window.openToast({
                msg : '正在获取数据...',
                duration : 3000,
                position : 5,
                type : 0
            });
          }
           
          });
            }) 
 
        </script>
        
</html>